<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Sharp" rel="stylesheet">
    <link rel="stylesheet" href="/css_files/dashboard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <title>Responsive Dashboard Design #1 | AsmrProg</title>
    <style>
        
        :root {
            --primary-color: #191b19;
            --secondary-color: #2196f3;
            --danger-color: #f44336;
            --warning-color: #ff9800;
            --text-color: #3a2c2c;
            --bg-color: #f5f5f5;
            --card-bg: #fff;
            --border-color: #ddd;
        }

        .job-container {
            padding: 20px;
            max-width: 1200px;
            margin: auto;
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .dashboard-header h1 {
            font-size: 24px;
            margin: 0;
        }
        /* Styling the stat cards */
        .stats-cards {
            height:auto;
            width: auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        /* Card general style */
        .card {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease; /* Adding smooth transition */
        }

        /* Individual Background Colors */
        .card:nth-child(1) {
            border-color:#4caf50 ;
            background-color: #4caf50; /* Green */
            color: white;
        }
        .card:nth-child(2) {
            border-color:#2196f3 ;
            background-color: #2196f3; /* Blue */
            color: white;
        }
        .card:nth-child(3) {
            border-color:#ff9800;
            background-color: #ff9800; /* Orange */
            color: white;
        }
        .card:nth-child(4) {
            border-color:#f44336 ;
            background-color: #f44336; /* Red */
            color: white;
        }

        /* Hover Effect */
        .card:hover {
            transform: translateY(-10px); /* Slight lift effect */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Stronger shadow */
            cursor: pointer; /* Pointer cursor on hover */
        }

        /* Hover effect for each card */
        .card:nth-child(1):hover {
            background-color: #66bb6a; /* Lighter green */
        }
        .card:nth-child(2):hover {
            background-color: #42a5f5; /* Lighter blue */
        }
        .card:nth-child(3):hover {
            background-color: #ffb74d; /* Lighter orange */
        }
        .card:nth-child(4):hover {
            background-color: #e57373; /* Lighter red */
        }

        /* Card title */
        .card h3 {
            margin: 0;
            font-size: 26px;
            color: var(--primary-color);
            transition: color 0.3s ease;
        }

        /* Card description */
        .card p {
            margin: 10px 0 0;
            font-size: 14px;
            color: var(--text-color);
            transition: color 0.3s ease;
        }

        /* Hover effects for cards */
        .card:hover {
            transform: translateY(-10px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.15);
        }

        .card:hover h3 {
            color: var(--secondary-color);
        }

        .card:hover p {
            color: var(--text-color);
        }

        /* Animation for card number */
        .card h3 {
            font-size: 26px;
            font-weight: bold;
            transition: transform 0.5s ease-out, color 0.3s ease;
        }

        .card h3.animate {
            transform: scale(1.2);
            color: var(--primary-color);
        }


            .users-section {
                overflow-y: auto; /* Makes the box scrollable */
                height: 100%; /* Ensures it uses the available space */
                max-height: 500px; /* Set a max height for scrolling */
                padding-right: 5px;
                width: 100%; /* Take full width of the main section */
                background-color: #fff;
                padding: 30px;
                border-radius: 8px;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                max-height: 100vh; /* Set max height for the box */
                overflow: hidden; /* Hide overflow of content */
                position: relative; /* Allow sticky positioning for heading */
            }

            .users-section h1 {
                font-size: 24px;
                font-weight: bold;
                margin-bottom: 20px;
                color: #333;
                position: sticky; /* Keep the heading fixed */
                top: 0; /* Fix the heading at the top */
                background-color: #fff; /* Match background with the section */
                padding-top: 10px; /* Add top padding for better spacing */
                z-index: 1; /* Ensure it stays on top of the table */
            }

            .users-table {
                width: 100%;
                margin-top: 20px;
                border-collapse: collapse;
                max-height: calc(80vh - 60px); /* Allow space for heading */
                overflow-y: auto; /* Enable vertical scrolling for the table */
                display: block; /* Make the table block element to enable scrolling */
            }

            .users-table table {
                width: 100%;
                border: 1px solid #ddd;
                border-radius: 8px;
                overflow: hidden;
            }

            .users-table th,
            .users-table td {
                padding: 12px;
                text-align: left;
                font-size: 14px;
                color: #555;
            }

            .users-table th {
                background-color: #f5f5f5;
                font-weight: bold;
            }

            .users-table tr:nth-child(even) {
                background-color: #f9f9f9;
            }

            .users-table tr:hover {
                background-color: #f0f0f0;
            }

            .users-table td button {
                margin: 0 5px;
                padding: 6px 12px;
                font-size: 14px;
                border: none;
                cursor: pointer;
                border-radius: 5px;
                transition: background-color 0.3s ease;
            }
            
            /* Flash messages */
            .flash-message {
                position: absolute;
                top: 20px;
                left: 50%;
                transform: translate(-50%, -50%);
                padding: 12px;
                border-radius: 6px;
                color: white;
            }

            .flash-message.error {
                background-color: #dc3545;
            }

            .flash-message.success {
                background-color: #28a745;
            }
        </style>
</head>
<body>
    <% if(error.length > 0) { %>
        <div class="flash-message error">
            <span><%= error %></span>
        </div>
    <% } %>
    
    <% if(success.length > 0) { %>
        <div class="flash-message success">
            <span><%= success %></span>
        </div>
    <% } %>
    <div class="container">
        <!-- Sidebar Section -->
        <aside>
            <div class="toggle">
                <div class="logo">
                    <span class="danger">Nexon</span></h2>
                </div>
                <div class="close" id="close-btn">
                    <span class="material-icons-sharp">
                        close
                    </span>
                </div>
            </div>

            <div class="sidebar">
                <a href="/admin_dashboard">
                    <span class="material-icons-sharp">
                        dashboard
                    </span>
                    <h3>Dashboard</h3></button>
                </a>
                <a href="/owners/users">
                    <span class="material-icons-sharp">
                        person_outline
                    </span>
                    <h3>Employees</h3></button>
                </a>
                <a href="/owners/history">
                    <span class="material-icons-sharp">
                        receipt_long
                    </span>
                    <h3>History</h3>
                </a>
                <a href="/owners/analytics" class="active">
                    <span class="material-icons-sharp">
                        insights
                    </span>
                    <h3>Analytics</h3>
                </a>
                <a href="/owners/tickets">
                    <span class="material-icons-sharp">
                        assignment
                    </span>
                    <h3>Tickets</h3>
                </a>
                <a href="/owners/jobs">
                    <span class="material-icons-sharp">
                        category
                    </span>
                    <h3>Products</h3>
                </a>
                <a href="/owners/calendar">
                    <span class="fa fa-calendar-o" 
                    style="font-size: 18px;"></span>
                    <h3>Calendar</h3>
                </a>
                <a href="/owners/new_emp">
                    <span class="material-icons-sharp">
                        add
                    </span>
                    <h3>New Login</h3>
                </a>
                <a href="/owners/createProduct">
                    <span class="material-icons-sharp">
                        add
                    </span>
                    <h3>Create Product</h3>
                </a>
                <a href="/owners/Messages">
                    <span class="material-icons-sharp">
                        message
                    </span>
                    <h3>Messages</h3>
                </a>
                <a href="/logoutPage">
                    <span class="material-icons-sharp">
                        logout
                    </span>
                    <h3>Logout</h3>
                </a>
            </div>
        </aside>
        <!-- End of Sidebar Section -->

        <main>
            <div class="job-container">
                <div class="dashboard-header">
                    <h1>Products Dashboard</h1>
                </div>
                
                <div class="stats-cards">
                    <div class="card">
                        <h3><%= totalProducts %></h3>
                        <p>Total Products</p>
                    </div>
                    <div class="card">
                        <h3><%= bestProduct ? bestProduct : "N/A" %></h3>
                        <p>Best Performing Product</p>
                    </div>
                    <div class="card">
                        <h3><%= underProduct ? underProduct : "N/A" %></h3>
                        <p>Under Performing Product</p>
                    </div>
                </div>
                <br><br>
        
                <div class="grid-section">
                    <div class="users-section">
                        <h1>Products</h1>
                        <div class="users-table">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Picture</th>
                                        <th>Name</th>
                                        <th>Price</th>
                                        <th>Stock available</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% products.forEach(function(product){ %>
                                            <tr>
                                                <td>
                                                    <div class="profile-photo">
                                                        <img src="data:image/jpeg;base64,<%= product.image.toString('base64') %>" alt="">
                                                    </div>
                                                </td>
                                                <td><%= product.name %></td>
                                                <td>â‚¹ <%= product.price %></td>
                                                <td><%= product.stock %> Units</td>
                                                <td><a href="/editproduct/<%= product._id %>"><b><span class="material-icons-sharp">edit</span>EDIT</b></a></td>
                                                
                                            </tr>
                                    <% }) %>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
            </div>
        </main>


        <!-- Right Section -->
        <div class="right-section">
            <div class="nav">
                <button id="menu-btn">
                    <span class="material-icons-sharp">
                        menu
                    </span>
                </button>
                <div class="dark-mode">
                    <span class="material-icons-sharp active">
                        light_mode
                    </span>
                    <span class="material-icons-sharp">
                        dark_mode
                    </span>
                </div>

                <div class="profile">
                    <a href="/profile">
                        <div class="info">
                            <p>Hey, <b><%= owner.username %></b></p>
                            <small class="text-muted"><%= owner.role %></small>
                        </div></a>
                        <a href="/profile">
                            <div class="profile-photo">
                                <img src="data:image/jpeg;base64,<%= owner.picture.toString('base64') %>" alt="">
                            </div>
                        </a>
                        
                    
                </div>

            </div>
            <!-- End of Nav -->

            <div class="user-profile">
                <div class="logo">
                    <img src="data:image/jpeg;base64,<%= owner.companyPicture.toString('base64') %>" alt="">
                    <h2><%= owner.company %></h2>
                </div>
            </div>

            <div class="reminders">
                <div class="header">
                    <h2>Today's Events</h2>
                    
                </div>

                <% 
                const today = new Date();
                const formattedToday = today.toISOString().split('T')[0]; // Get today's date in YYYY-MM-DD format
            
                owner.events.forEach(function(event) { 
                    const eventDate = new Date(event.start).toISOString().split('T')[0]; // Extract event date
            
                    if (eventDate === formattedToday) { 
            %>
                    <div class="notification">
                        <div class="icon">
                            <span class="material-icons-sharp">
                                event
                            </span>
                        </div>
                        <div class="content">
                            <div class="info">
                                <h3><%= event.title %></h3>
                                <small class="text_muted">
                                    <%= event.formattedToday %>
                                </small>
                            </div>
                            <a href="/deleteEvent/<%= event._id %>">
                                <span class="material-icons-sharp">
                                delete
                            </span>
                            </a>
                        </div>
                    </div>
            <% 
                    }
                }); 
            %>
            
                


                <a href="/owners/calendar">
                <div class="notification add-reminder">
                
                    <div>
                        <span class="material-icons-sharp">
                            add
                        </span>
                        <h3>Add Event</h3>
                    </div>
                </div>
                </a>
                

            </div>


        </div>
    </div>
    <script>
        // Wait for the DOM to be fully loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Select all flash messages
            var flashMessages = document.querySelectorAll('.flash-message');

            // Iterate through each flash message
            flashMessages.forEach(function(message) {
            // Set a timeout to remove the message after 5 seconds (5000 milliseconds)
            setTimeout(function() {
                message.style.display = 'none';
            }, 5000);
            });
        });

      </script>
    <script src="/public/js_files/index.js"></script>
</body>

</html>